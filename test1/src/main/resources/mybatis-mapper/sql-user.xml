<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.test1.mapper.UserMapper">
	<select id="selectUser" parameterType="hashmap"
		resultType="com.example.test1.model.User">
		SELECT *
		FROM ECO_USER
		WHERE USERID = #{userId}
	</select>
	<insert id="insertUser" parameterType="hashmap">
		INSERT INTO ECO_USER
		VALUES
		(#{userId}, #{userPw}, #{name}, #{nickName}, #{gender},
		#{phone1}, #{phone2},
		#{phone3}, #{email}, #{birth}, 'SILVER', 'N',
		#{eventYn}, 0, 0, 0,
		'U', NOW(), NOW(), NOW(), DATE_ADD(NOW(), INTERVAL 3 MONTH))
	</insert>
	<insert id="insertUserAddr" parameterType="hashmap">
		INSERT INTO ECO_ADDR
		(USERID, ADDR, ADDRDETAIL, ZIPCODE, NAME, PHONE, ADDRREQUEST,
		ADDRNAME)
		VALUES(#{userId}, #{addr}, #{addrDetail}, #{zipCode},
		#{name}, #{phone}, NULL, #{addrName})
	</insert>
	<!-- 유저 마이페이지 수정 -->
	<update id="updateUser" parameterType="hashmap">
		UPDATE ECO_USER
		SET
		USERPW =
		#{userPw}, NAME = #{name}, NICKNAME = #{nickName}, GENDER = #{gender}, 
		PHONE1 = #{phone1}, PHONE2 = #{phone2}, PHONE3 = #{phone3},
		EMAIL = #{email}, BIRTH = #{birth}
		WHERE USERID = #{userId}
	</update>

	<!-- 유저 마이페이지 주소록 호출 및 개수제한 -->
	<select id="selectAddr" parameterType="hashmap"
		resultType="com.example.test1.model.Addr">
		SELECT ECO_ADDR.*, user_counts.CNT
		FROM ECO_ADDR
		JOIN (
		SELECT USERID, COUNT(*) AS CNT
		FROM ECO_ADDR
		GROUP BY USERID
		) AS user_counts ON ECO_ADDR.USERID = user_counts.USERID
		WHERE ECO_ADDR.USERID = #{userId}
	</select>
	<!-- 유저 마이페이지 주소록 삭제 -->
	<delete id="deleteAddr" parameterType="hashmap">
		DELETE FROM ECO_ADDR
		WHERE ADDRNO = #{addrNo}
	</delete>
	<!-- 유저 마이페이지 주소록 추가 -->
	<insert id="insertMyPageAddrAdd" parameterType="hashmap">
		INSERT INTO
		ECO_ADDR VALUES(NULL, #{userId}, #{addr}, #{addrDetail}, #{zipCode},
		#{name}, #{phone}, #{addrRequest}, #{addrName})
	</insert>
	<!-- 유저 마이페이지 주소록 호출 -->
	<select id="selectAddrAddNo" parameterType="hashmap"
		resultType="com.example.test1.model.Addr">
		SELECT *
		FROM ECO_ADDR
		WHERE ADDRNO = #{addrNo}
	</select>
	<!-- 유저 마이페이지 주소록 수정 -->
	<update id="updateAddr" parameterType="hashmap">
		UPDATE ECO_ADDR
		SET
		ADDRNO = #{addrNo}, USERID = #{userId}, ADDR = #{addr}, ADDRDETAIL = #{addrDetail}, 
		ZIPCODE = #{zipCode}, NAME = #{name}, PHONE = #{phone}, ADDRREQUEST = #{addrRequest}, 
		ADDRNAME = #{addrName} WHERE ADDRNO = #{addrNo}
	</update>
</mapper>